{"dependencies":[{"name":"../integration.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":54,"index":54}}],"key":"B8aKvpmafw58aWtupuC7GWTMiwo=","exportNames":["*"]}},{"name":"../utils-hoist/requestdata.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":55},"end":{"line":2,"column":103,"index":158}}],"key":"W8gbFGwnwad6WQhIdV+KPKZNVVo=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.requestDataIntegration = void 0;\n  var _integration = require(_dependencyMap[0], \"../integration.js\");\n  var _requestdata = require(_dependencyMap[1], \"../utils-hoist/requestdata.js\");\n  const DEFAULT_OPTIONS = {\n    include: {\n      cookies: true,\n      data: true,\n      headers: true,\n      ip: false,\n      query_string: true,\n      url: true,\n      user: {\n        id: true,\n        username: true,\n        email: true\n      }\n    },\n    transactionNamingScheme: 'methodPath'\n  };\n  const INTEGRATION_NAME = 'RequestData';\n  const _requestDataIntegration = (options = {}) => {\n    const _options = {\n      ...DEFAULT_OPTIONS,\n      ...options,\n      include: {\n        ...DEFAULT_OPTIONS.include,\n        ...options.include,\n        user: options.include && typeof options.include.user === 'boolean' ? options.include.user : {\n          ...DEFAULT_OPTIONS.include.user,\n          // Unclear why TS still thinks `options.include.user` could be a boolean at this point\n          ...(options.include || {}).user\n        }\n      }\n    };\n    return {\n      name: INTEGRATION_NAME,\n      processEvent(event) {\n        // Note: In the long run, most of the logic here should probably move into the request data utility functions. For\n        // the moment it lives here, though, until https://github.com/getsentry/sentry-javascript/issues/5718 is addressed.\n        // (TL;DR: Those functions touch many parts of the repo in many different ways, and need to be cleaned up. Once\n        // that's happened, it will be easier to add this logic in without worrying about unexpected side effects.)\n\n        const {\n          sdkProcessingMetadata = {}\n        } = event;\n        const {\n          request,\n          normalizedRequest\n        } = sdkProcessingMetadata;\n        const addRequestDataOptions = convertReqDataIntegrationOptsToAddReqDataOpts(_options);\n\n        // If this is set, it takes precedence over the plain request object\n        if (normalizedRequest) {\n          // Some other data is not available in standard HTTP requests, but can sometimes be augmented by e.g. Express or Next.js\n          const ipAddress = request ? request.ip || request.socket && request.socket.remoteAddress : undefined;\n          const user = request ? request.user : undefined;\n          (0, _requestdata.addNormalizedRequestDataToEvent)(event, normalizedRequest, {\n            ipAddress,\n            user\n          }, addRequestDataOptions);\n          return event;\n        }\n\n        // TODO(v9): Eventually we can remove this fallback branch and only rely on the normalizedRequest above\n        if (!request) {\n          return event;\n        }\n\n        // eslint-disable-next-line deprecation/deprecation\n        return (0, _requestdata.addRequestDataToEvent)(event, request, addRequestDataOptions);\n      }\n    };\n  };\n\n  /**\n   * Add data about a request to an event. Primarily for use in Node-based SDKs, but included in `@sentry/core`\n   * so it can be used in cross-platform SDKs like `@sentry/nextjs`.\n   */\n  const requestDataIntegration = exports.requestDataIntegration = (0, _integration.defineIntegration)(_requestDataIntegration);\n\n  /** Convert this integration's options to match what `addRequestDataToEvent` expects */\n  /** TODO: Can possibly be deleted once https://github.com/getsentry/sentry-javascript/issues/5718 is fixed */\n  function convertReqDataIntegrationOptsToAddReqDataOpts(integrationOptions) {\n    const {\n      // eslint-disable-next-line deprecation/deprecation\n      transactionNamingScheme,\n      include: {\n        ip,\n        user,\n        ...requestOptions\n      }\n    } = integrationOptions;\n    const requestIncludeKeys = ['method'];\n    for (const [key, value] of Object.entries(requestOptions)) {\n      if (value) {\n        requestIncludeKeys.push(key);\n      }\n    }\n    let addReqDataUserOpt;\n    if (user === undefined) {\n      addReqDataUserOpt = true;\n    } else if (typeof user === 'boolean') {\n      addReqDataUserOpt = user;\n    } else {\n      const userIncludeKeys = [];\n      for (const [key, value] of Object.entries(user)) {\n        if (value) {\n          userIncludeKeys.push(key);\n        }\n      }\n      addReqDataUserOpt = userIncludeKeys;\n    }\n    return {\n      include: {\n        ip,\n        user: addReqDataUserOpt,\n        request: requestIncludeKeys.length !== 0 ? requestIncludeKeys : undefined,\n        transaction: transactionNamingScheme\n      }\n    };\n  }\n});","lineCount":126,"map":[[6,2,1,0],[6,6,1,0,"_integration"],[6,18,1,0],[6,21,1,0,"require"],[6,28,1,0],[6,29,1,0,"_dependencyMap"],[6,43,1,0],[7,2,2,0],[7,6,2,0,"_requestdata"],[7,18,2,0],[7,21,2,0,"require"],[7,28,2,0],[7,29,2,0,"_dependencyMap"],[7,43,2,0],[8,2,4,0],[8,8,4,6,"DEFAULT_OPTIONS"],[8,23,4,21],[8,26,4,24],[9,4,5,2,"include"],[9,11,5,9],[9,13,5,11],[10,6,6,4,"cookies"],[10,13,6,11],[10,15,6,13],[10,19,6,17],[11,6,7,4,"data"],[11,10,7,8],[11,12,7,10],[11,16,7,14],[12,6,8,4,"headers"],[12,13,8,11],[12,15,8,13],[12,19,8,17],[13,6,9,4,"ip"],[13,8,9,6],[13,10,9,8],[13,15,9,13],[14,6,10,4,"query_string"],[14,18,10,16],[14,20,10,18],[14,24,10,22],[15,6,11,4,"url"],[15,9,11,7],[15,11,11,9],[15,15,11,13],[16,6,12,4,"user"],[16,10,12,8],[16,12,12,10],[17,8,13,6,"id"],[17,10,13,8],[17,12,13,10],[17,16,13,14],[18,8,14,6,"username"],[18,16,14,14],[18,18,14,16],[18,22,14,20],[19,8,15,6,"email"],[19,13,15,11],[19,15,15,13],[20,6,16,4],[21,4,17,2],[21,5,17,3],[22,4,18,2,"transactionNamingScheme"],[22,27,18,25],[22,29,18,27],[23,2,19,0],[23,3,19,1],[24,2,21,0],[24,8,21,6,"INTEGRATION_NAME"],[24,24,21,22],[24,27,21,25],[24,40,21,38],[25,2,23,0],[25,8,23,6,"_requestDataIntegration"],[25,31,23,29],[25,34,23,33,"_requestDataIntegration"],[25,35,23,34,"options"],[25,42,23,41],[25,45,23,44],[25,46,23,45],[25,47,23,46],[25,52,23,51],[26,4,24,2],[26,10,24,8,"_options"],[26,18,24,16],[26,21,24,19],[27,6,25,4],[27,9,25,7,"DEFAULT_OPTIONS"],[27,24,25,22],[28,6,26,4],[28,9,26,7,"options"],[28,16,26,14],[29,6,27,4,"include"],[29,13,27,11],[29,15,27,13],[30,8,28,6],[30,11,28,9,"DEFAULT_OPTIONS"],[30,26,28,24],[30,27,28,25,"include"],[30,34,28,32],[31,8,29,6],[31,11,29,9,"options"],[31,18,29,16],[31,19,29,17,"include"],[31,26,29,24],[32,8,30,6,"user"],[32,12,30,10],[32,14,31,8,"options"],[32,21,31,15],[32,22,31,16,"include"],[32,29,31,23],[32,33,31,27],[32,40,31,34,"options"],[32,47,31,41],[32,48,31,42,"include"],[32,55,31,49],[32,56,31,50,"user"],[32,60,31,54],[32,65,31,59],[32,74,31,68],[32,77,32,12,"options"],[32,84,32,19],[32,85,32,20,"include"],[32,92,32,27],[32,93,32,28,"user"],[32,97,32,32],[32,100,33,12],[33,10,34,14],[33,13,34,17,"DEFAULT_OPTIONS"],[33,28,34,32],[33,29,34,33,"include"],[33,36,34,40],[33,37,34,41,"user"],[33,41,34,45],[34,10,35,14],[35,10,36,14],[35,13,36,18],[35,14,36,19,"options"],[35,21,36,26],[35,22,36,27,"include"],[35,29,36,34],[35,33,36,38],[35,34,36,39],[35,35,36,40],[35,37,36,42,"user"],[36,8,37,12],[37,6,38,4],[38,4,39,2],[38,5,39,3],[39,4,41,2],[39,11,41,9],[40,6,42,4,"name"],[40,10,42,8],[40,12,42,10,"INTEGRATION_NAME"],[40,28,42,26],[41,6,43,4,"processEvent"],[41,18,43,16,"processEvent"],[41,19,43,17,"event"],[41,24,43,22],[41,26,43,24],[42,8,44,6],[43,8,45,6],[44,8,46,6],[45,8,47,6],[47,8,49,6],[47,14,49,12],[48,10,49,14,"sdkProcessingMetadata"],[48,31,49,35],[48,34,49,38],[48,35,49,39],[49,8,49,41],[49,9,49,42],[49,12,49,45,"event"],[49,17,49,50],[50,8,50,6],[50,14,50,12],[51,10,50,14,"request"],[51,17,50,21],[52,10,50,23,"normalizedRequest"],[53,8,50,41],[53,9,50,42],[53,12,50,45,"sdkProcessingMetadata"],[53,33,50,66],[54,8,52,6],[54,14,52,12,"addRequestDataOptions"],[54,35,52,33],[54,38,52,36,"convertReqDataIntegrationOptsToAddReqDataOpts"],[54,83,52,81],[54,84,52,82,"_options"],[54,92,52,90],[54,93,52,91],[56,8,54,6],[57,8,55,6],[57,12,55,10,"normalizedRequest"],[57,29,55,27],[57,31,55,29],[58,10,56,8],[59,10,57,8],[59,16,57,14,"ipAddress"],[59,25,57,23],[59,28,57,26,"request"],[59,35,57,33],[59,38,57,36,"request"],[59,45,57,43],[59,46,57,44,"ip"],[59,48,57,46],[59,52,57,51,"request"],[59,59,57,58],[59,60,57,59,"socket"],[59,66,57,65],[59,70,57,69,"request"],[59,77,57,76],[59,78,57,77,"socket"],[59,84,57,83],[59,85,57,84,"remoteAddress"],[59,98,57,98],[59,101,57,101,"undefined"],[59,110,57,110],[60,10,58,8],[60,16,58,14,"user"],[60,20,58,18],[60,23,58,21,"request"],[60,30,58,28],[60,33,58,31,"request"],[60,40,58,38],[60,41,58,39,"user"],[60,45,58,43],[60,48,58,46,"undefined"],[60,57,58,55],[61,10,60,8],[61,14,60,8,"addNormalizedRequestDataToEvent"],[61,58,60,39],[61,60,60,40,"event"],[61,65,60,45],[61,67,60,47,"normalizedRequest"],[61,84,60,64],[61,86,60,66],[62,12,60,68,"ipAddress"],[62,21,60,77],[63,12,60,79,"user"],[64,10,60,84],[64,11,60,85],[64,13,60,87,"addRequestDataOptions"],[64,34,60,108],[64,35,60,109],[65,10,61,8],[65,17,61,15,"event"],[65,22,61,20],[66,8,62,6],[68,8,64,6],[69,8,65,6],[69,12,65,10],[69,13,65,11,"request"],[69,20,65,18],[69,22,65,20],[70,10,66,8],[70,17,66,15,"event"],[70,22,66,20],[71,8,67,6],[73,8,69,6],[74,8,70,6],[74,15,70,13],[74,19,70,13,"addRequestDataToEvent"],[74,53,70,34],[74,55,70,35,"event"],[74,60,70,40],[74,62,70,42,"request"],[74,69,70,49],[74,71,70,51,"addRequestDataOptions"],[74,92,70,72],[74,93,70,73],[75,6,71,4],[76,4,72,2],[76,5,72,3],[77,2,73,0],[77,3,73,2],[79,2,75,0],[80,0,76,0],[81,0,77,0],[82,0,78,0],[83,2,79,0],[83,8,79,6,"requestDataIntegration"],[83,30,79,28],[83,33,79,28,"exports"],[83,40,79,28],[83,41,79,28,"requestDataIntegration"],[83,63,79,28],[83,66,79,31],[83,70,79,31,"defineIntegration"],[83,100,79,48],[83,102,79,49,"_requestDataIntegration"],[83,125,79,72],[83,126,79,73],[85,2,81,0],[86,2,82,0],[87,2,83,0],[87,11,83,9,"convertReqDataIntegrationOptsToAddReqDataOpts"],[87,56,83,54,"convertReqDataIntegrationOptsToAddReqDataOpts"],[87,57,84,2,"integrationOptions"],[87,75,84,20],[87,77,85,2],[88,4,86,2],[88,10,86,8],[89,6,87,4],[90,6,88,4,"transactionNamingScheme"],[90,29,88,27],[91,6,89,4,"include"],[91,13,89,11],[91,15,89,13],[92,8,89,15,"ip"],[92,10,89,17],[93,8,89,19,"user"],[93,12,89,23],[94,8,89,25],[94,11,89,28,"requestOptions"],[95,6,89,43],[96,4,90,2],[96,5,90,3],[96,8,90,6,"integrationOptions"],[96,26,90,24],[97,4,92,2],[97,10,92,8,"requestIncludeKeys"],[97,28,92,26],[97,31,92,29],[97,32,92,30],[97,40,92,38],[97,41,92,39],[98,4,93,2],[98,9,93,7],[98,15,93,13],[98,16,93,14,"key"],[98,19,93,17],[98,21,93,19,"value"],[98,26,93,24],[98,27,93,25],[98,31,93,29,"Object"],[98,37,93,35],[98,38,93,36,"entries"],[98,45,93,43],[98,46,93,44,"requestOptions"],[98,60,93,58],[98,61,93,59],[98,63,93,61],[99,6,94,4],[99,10,94,8,"value"],[99,15,94,13],[99,17,94,15],[100,8,95,6,"requestIncludeKeys"],[100,26,95,24],[100,27,95,25,"push"],[100,31,95,29],[100,32,95,30,"key"],[100,35,95,33],[100,36,95,34],[101,6,96,4],[102,4,97,2],[103,4,99,2],[103,8,99,6,"addReqDataUserOpt"],[103,25,99,23],[104,4,100,2],[104,8,100,6,"user"],[104,12,100,10],[104,17,100,15,"undefined"],[104,26,100,24],[104,28,100,26],[105,6,101,4,"addReqDataUserOpt"],[105,23,101,21],[105,26,101,24],[105,30,101,28],[106,4,102,2],[106,5,102,3],[106,11,102,9],[106,15,102,13],[106,22,102,20,"user"],[106,26,102,24],[106,31,102,29],[106,40,102,38],[106,42,102,40],[107,6,103,4,"addReqDataUserOpt"],[107,23,103,21],[107,26,103,24,"user"],[107,30,103,28],[108,4,104,2],[108,5,104,3],[108,11,104,9],[109,6,105,4],[109,12,105,10,"userIncludeKeys"],[109,27,105,25],[109,30,105,28],[109,32,105,30],[110,6,106,4],[110,11,106,9],[110,17,106,15],[110,18,106,16,"key"],[110,21,106,19],[110,23,106,21,"value"],[110,28,106,26],[110,29,106,27],[110,33,106,31,"Object"],[110,39,106,37],[110,40,106,38,"entries"],[110,47,106,45],[110,48,106,46,"user"],[110,52,106,50],[110,53,106,51],[110,55,106,53],[111,8,107,6],[111,12,107,10,"value"],[111,17,107,15],[111,19,107,17],[112,10,108,8,"userIncludeKeys"],[112,25,108,23],[112,26,108,24,"push"],[112,30,108,28],[112,31,108,29,"key"],[112,34,108,32],[112,35,108,33],[113,8,109,6],[114,6,110,4],[115,6,111,4,"addReqDataUserOpt"],[115,23,111,21],[115,26,111,24,"userIncludeKeys"],[115,41,111,39],[116,4,112,2],[117,4,114,2],[117,11,114,9],[118,6,115,4,"include"],[118,13,115,11],[118,15,115,13],[119,8,116,6,"ip"],[119,10,116,8],[120,8,117,6,"user"],[120,12,117,10],[120,14,117,12,"addReqDataUserOpt"],[120,31,117,29],[121,8,118,6,"request"],[121,15,118,13],[121,17,118,15,"requestIncludeKeys"],[121,35,118,33],[121,36,118,34,"length"],[121,42,118,40],[121,47,118,45],[121,48,118,46],[121,51,118,49,"requestIncludeKeys"],[121,69,118,67],[121,72,118,70,"undefined"],[121,81,118,79],[122,8,119,6,"transaction"],[122,19,119,17],[122,21,119,19,"transactionNamingScheme"],[123,6,120,4],[124,4,121,2],[124,5,121,3],[125,2,122,0],[126,0,122,1],[126,3]],"functionMap":{"names":["<global>","_requestDataIntegration","processEvent","convertReqDataIntegrationOptsToAddReqDataOpts"],"mappings":"AAA;iCCsB;ICoB;KD4B;CDE;AGU;CHuC"}},"type":"js/module"}]}