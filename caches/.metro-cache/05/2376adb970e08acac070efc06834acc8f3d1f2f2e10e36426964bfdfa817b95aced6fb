{"dependencies":[{"name":"../utils-hoist/dsn.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"hE73T8lxjg3QP51un58ou5NlBEc=","exportNames":["*"]}},{"name":"../utils-hoist/envelope.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":60,"index":113}}],"key":"/wcaZSbu8ehBqhp+Lmxp451SsSA=","exportNames":["*"]}},{"name":"../utils-hoist/logger.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":114},"end":{"line":3,"column":50,"index":164}}],"key":"ntkLGOO3yQLxIuhQNqZB03aOwxw=","exportNames":["*"]}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":165},"end":{"line":4,"column":52,"index":217}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.captureAggregateMetrics = captureAggregateMetrics;\n  exports.createMetricEnvelope = createMetricEnvelope;\n  var _dsn = require(_dependencyMap[0], \"../utils-hoist/dsn.js\");\n  var _envelope = require(_dependencyMap[1], \"../utils-hoist/envelope.js\");\n  var _logger = require(_dependencyMap[2], \"../utils-hoist/logger.js\");\n  var _utils = require(_dependencyMap[3], \"./utils.js\");\n  /**\n   * Captures aggregated metrics to the supplied client.\n   */\n  function captureAggregateMetrics(client, metricBucketItems) {\n    _logger.logger.log(`Flushing aggregated metrics, number of metrics: ${metricBucketItems.length}`);\n    const dsn = client.getDsn();\n    const metadata = client.getSdkMetadata();\n    const tunnel = client.getOptions().tunnel;\n    const metricsEnvelope = createMetricEnvelope(metricBucketItems, dsn, metadata, tunnel);\n\n    // sendEnvelope should not throw\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    client.sendEnvelope(metricsEnvelope);\n  }\n\n  /**\n   * Create envelope from a metric aggregate.\n   */\n  function createMetricEnvelope(metricBucketItems, dsn, metadata, tunnel) {\n    const headers = {\n      sent_at: new Date().toISOString()\n    };\n    if (metadata && metadata.sdk) {\n      headers.sdk = {\n        name: metadata.sdk.name,\n        version: metadata.sdk.version\n      };\n    }\n    if (!!tunnel && dsn) {\n      headers.dsn = (0, _dsn.dsnToString)(dsn);\n    }\n    const item = createMetricEnvelopeItem(metricBucketItems);\n    return (0, _envelope.createEnvelope)(headers, [item]);\n  }\n  function createMetricEnvelopeItem(metricBucketItems) {\n    const payload = (0, _utils.serializeMetricBuckets)(metricBucketItems);\n    const metricHeaders = {\n      type: 'statsd',\n      length: payload.length\n    };\n    return [metricHeaders, payload];\n  }\n});","lineCount":53,"map":[[7,2,1,0],[7,6,1,0,"_dsn"],[7,10,1,0],[7,13,1,0,"require"],[7,20,1,0],[7,21,1,0,"_dependencyMap"],[7,35,1,0],[8,2,2,0],[8,6,2,0,"_envelope"],[8,15,2,0],[8,18,2,0,"require"],[8,25,2,0],[8,26,2,0,"_dependencyMap"],[8,40,2,0],[9,2,3,0],[9,6,3,0,"_logger"],[9,13,3,0],[9,16,3,0,"require"],[9,23,3,0],[9,24,3,0,"_dependencyMap"],[9,38,3,0],[10,2,4,0],[10,6,4,0,"_utils"],[10,12,4,0],[10,15,4,0,"require"],[10,22,4,0],[10,23,4,0,"_dependencyMap"],[10,37,4,0],[11,2,6,0],[12,0,7,0],[13,0,8,0],[14,2,9,0],[14,11,9,9,"captureAggregateMetrics"],[14,34,9,32,"captureAggregateMetrics"],[14,35,9,33,"client"],[14,41,9,39],[14,43,9,41,"metricBucketItems"],[14,60,9,58],[14,62,9,60],[15,4,10,2,"logger"],[15,18,10,8],[15,19,10,9,"log"],[15,22,10,12],[15,23,10,13],[15,74,10,64,"metricBucketItems"],[15,91,10,81],[15,92,10,82,"length"],[15,98,10,88],[15,100,10,90],[15,101,10,91],[16,4,11,2],[16,10,11,8,"dsn"],[16,13,11,11],[16,16,11,14,"client"],[16,22,11,20],[16,23,11,21,"getDsn"],[16,29,11,27],[16,30,11,28],[16,31,11,29],[17,4,12,2],[17,10,12,8,"metadata"],[17,18,12,16],[17,21,12,19,"client"],[17,27,12,25],[17,28,12,26,"getSdkMetadata"],[17,42,12,40],[17,43,12,41],[17,44,12,42],[18,4,13,2],[18,10,13,8,"tunnel"],[18,16,13,14],[18,19,13,17,"client"],[18,25,13,23],[18,26,13,24,"getOptions"],[18,36,13,34],[18,37,13,35],[18,38,13,36],[18,39,13,37,"tunnel"],[18,45,13,43],[19,4,15,2],[19,10,15,8,"metricsEnvelope"],[19,25,15,23],[19,28,15,26,"createMetricEnvelope"],[19,48,15,46],[19,49,15,47,"metricBucketItems"],[19,66,15,64],[19,68,15,66,"dsn"],[19,71,15,69],[19,73,15,71,"metadata"],[19,81,15,79],[19,83,15,81,"tunnel"],[19,89,15,87],[19,90,15,88],[21,4,17,2],[22,4,18,2],[23,4,19,2,"client"],[23,10,19,8],[23,11,19,9,"sendEnvelope"],[23,23,19,21],[23,24,19,22,"metricsEnvelope"],[23,39,19,37],[23,40,19,38],[24,2,20,0],[26,2,22,0],[27,0,23,0],[28,0,24,0],[29,2,25,0],[29,11,25,9,"createMetricEnvelope"],[29,31,25,29,"createMetricEnvelope"],[29,32,26,2,"metricBucketItems"],[29,49,26,19],[29,51,27,2,"dsn"],[29,54,27,5],[29,56,28,2,"metadata"],[29,64,28,10],[29,66,29,2,"tunnel"],[29,72,29,8],[29,74,30,2],[30,4,31,2],[30,10,31,8,"headers"],[30,17,31,15],[30,20,31,18],[31,6,32,4,"sent_at"],[31,13,32,11],[31,15,32,13],[31,19,32,17,"Date"],[31,23,32,21],[31,24,32,22],[31,25,32,23],[31,26,32,24,"toISOString"],[31,37,32,35],[31,38,32,36],[32,4,33,2],[32,5,33,3],[33,4,35,2],[33,8,35,6,"metadata"],[33,16,35,14],[33,20,35,18,"metadata"],[33,28,35,26],[33,29,35,27,"sdk"],[33,32,35,30],[33,34,35,32],[34,6,36,4,"headers"],[34,13,36,11],[34,14,36,12,"sdk"],[34,17,36,15],[34,20,36,18],[35,8,37,6,"name"],[35,12,37,10],[35,14,37,12,"metadata"],[35,22,37,20],[35,23,37,21,"sdk"],[35,26,37,24],[35,27,37,25,"name"],[35,31,37,29],[36,8,38,6,"version"],[36,15,38,13],[36,17,38,15,"metadata"],[36,25,38,23],[36,26,38,24,"sdk"],[36,29,38,27],[36,30,38,28,"version"],[37,6,39,4],[37,7,39,5],[38,4,40,2],[39,4,42,2],[39,8,42,6],[39,9,42,7],[39,10,42,8,"tunnel"],[39,16,42,14],[39,20,42,18,"dsn"],[39,23,42,21],[39,25,42,23],[40,6,43,4,"headers"],[40,13,43,11],[40,14,43,12,"dsn"],[40,17,43,15],[40,20,43,18],[40,24,43,18,"dsnToString"],[40,40,43,29],[40,42,43,30,"dsn"],[40,45,43,33],[40,46,43,34],[41,4,44,2],[42,4,46,2],[42,10,46,8,"item"],[42,14,46,12],[42,17,46,15,"createMetricEnvelopeItem"],[42,41,46,39],[42,42,46,40,"metricBucketItems"],[42,59,46,57],[42,60,46,58],[43,4,47,2],[43,11,47,9],[43,15,47,9,"createEnvelope"],[43,39,47,23],[43,41,47,24,"headers"],[43,48,47,31],[43,50,47,33],[43,51,47,34,"item"],[43,55,47,38],[43,56,47,39],[43,57,47,40],[44,2,48,0],[45,2,50,0],[45,11,50,9,"createMetricEnvelopeItem"],[45,35,50,33,"createMetricEnvelopeItem"],[45,36,50,34,"metricBucketItems"],[45,53,50,51],[45,55,50,53],[46,4,51,2],[46,10,51,8,"payload"],[46,17,51,15],[46,20,51,18],[46,24,51,18,"serializeMetricBuckets"],[46,53,51,40],[46,55,51,41,"metricBucketItems"],[46,72,51,58],[46,73,51,59],[47,4,52,2],[47,10,52,8,"metricHeaders"],[47,23,52,21],[47,26,52,24],[48,6,53,4,"type"],[48,10,53,8],[48,12,53,10],[48,20,53,18],[49,6,54,4,"length"],[49,12,54,10],[49,14,54,12,"payload"],[49,21,54,19],[49,22,54,20,"length"],[50,4,55,2],[50,5,55,3],[51,4,56,2],[51,11,56,9],[51,12,56,10,"metricHeaders"],[51,25,56,23],[51,27,56,25,"payload"],[51,34,56,32],[51,35,56,33],[52,2,57,0],[53,0,57,1],[53,3]],"functionMap":{"names":["<global>","captureAggregateMetrics","createMetricEnvelope","createMetricEnvelopeItem"],"mappings":"AAA;ACQ;CDW;AEK;CFuB;AGE;CHO"}},"type":"js/module"}]}