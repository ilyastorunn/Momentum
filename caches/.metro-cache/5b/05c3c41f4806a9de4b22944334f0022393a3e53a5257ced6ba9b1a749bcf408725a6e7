{"dependencies":[{"name":"@sentry-internal/browser-utils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":73,"index":73}}],"key":"NhwjGxy6N7nYR3SR4JfgASTvmbA=","exportNames":["*"]}},{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":74},"end":{"line":2,"column":76,"index":150}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"]}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":151},"end":{"line":3,"column":48,"index":199}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.INTEGRATION_NAME = void 0;\n  exports.isSpotlightInteraction = isSpotlightInteraction;\n  exports.spotlightBrowserIntegration = void 0;\n  var _browserUtils = require(_dependencyMap[0], \"@sentry-internal/browser-utils\");\n  var _core = require(_dependencyMap[1], \"@sentry/core\");\n  var _debugBuild = require(_dependencyMap[2], \"../debug-build.js\");\n  const INTEGRATION_NAME = exports.INTEGRATION_NAME = 'SpotlightBrowser';\n  const _spotlightIntegration = (options = {}) => {\n    const sidecarUrl = options.sidecarUrl || 'http://localhost:8969/stream';\n    return {\n      name: INTEGRATION_NAME,\n      setup: () => {\n        _debugBuild.DEBUG_BUILD && _core.logger.log('Using Sidecar URL', sidecarUrl);\n      },\n      // We don't want to send interaction transactions/root spans created from\n      // clicks within Spotlight to Sentry. Neither do we want them to be sent to\n      // spotlight.\n      processEvent: event => isSpotlightInteraction(event) ? null : event,\n      afterAllSetup: client => {\n        setupSidecarForwarding(client, sidecarUrl);\n      }\n    };\n  };\n  function setupSidecarForwarding(client, sidecarUrl) {\n    const makeFetch = (0, _browserUtils.getNativeImplementation)('fetch');\n    let failCount = 0;\n    client.on('beforeEnvelope', envelope => {\n      if (failCount > 3) {\n        _core.logger.warn('[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests:', failCount);\n        return;\n      }\n      makeFetch(sidecarUrl, {\n        method: 'POST',\n        body: (0, _core.serializeEnvelope)(envelope),\n        headers: {\n          'Content-Type': 'application/x-sentry-envelope'\n        },\n        mode: 'cors'\n      }).then(res => {\n        if (res.status >= 200 && res.status < 400) {\n          // Reset failed requests counter on success\n          failCount = 0;\n        }\n      }, err => {\n        failCount++;\n        _core.logger.error(\"Sentry SDK can't connect to Sidecar is it running? See: https://spotlightjs.com/sidecar/npx/\", err);\n      });\n    });\n  }\n\n  /**\n   * Use this integration to send errors and transactions to Spotlight.\n   *\n   * Learn more about spotlight at https://spotlightjs.com\n   */\n  const spotlightBrowserIntegration = exports.spotlightBrowserIntegration = (0, _core.defineIntegration)(_spotlightIntegration);\n\n  /**\n   * Flags if the event is a transaction created from an interaction with the spotlight UI.\n   */\n  function isSpotlightInteraction(event) {\n    return Boolean(event.type === 'transaction' && event.spans && event.contexts && event.contexts.trace && event.contexts.trace.op === 'ui.action.click' && event.spans.some(({\n      description\n    }) => description && description.includes('#sentry-spotlight')));\n  }\n});","lineCount":70,"map":[[8,2,1,0],[8,6,1,0,"_browserUtils"],[8,19,1,0],[8,22,1,0,"require"],[8,29,1,0],[8,30,1,0,"_dependencyMap"],[8,44,1,0],[9,2,2,0],[9,6,2,0,"_core"],[9,11,2,0],[9,14,2,0,"require"],[9,21,2,0],[9,22,2,0,"_dependencyMap"],[9,36,2,0],[10,2,3,0],[10,6,3,0,"_debugBuild"],[10,17,3,0],[10,20,3,0,"require"],[10,27,3,0],[10,28,3,0,"_dependencyMap"],[10,42,3,0],[11,2,5,0],[11,8,5,6,"INTEGRATION_NAME"],[11,24,5,22],[11,27,5,22,"exports"],[11,34,5,22],[11,35,5,22,"INTEGRATION_NAME"],[11,51,5,22],[11,54,5,25],[11,72,5,43],[12,2,7,0],[12,8,7,6,"_spotlightIntegration"],[12,29,7,27],[12,32,7,31,"_spotlightIntegration"],[12,33,7,32,"options"],[12,40,7,39],[12,43,7,42],[12,44,7,43],[12,45,7,44],[12,50,7,49],[13,4,8,2],[13,10,8,8,"sidecarUrl"],[13,20,8,18],[13,23,8,21,"options"],[13,30,8,28],[13,31,8,29,"sidecarUrl"],[13,41,8,39],[13,45,8,43],[13,75,8,73],[14,4,10,2],[14,11,10,9],[15,6,11,4,"name"],[15,10,11,8],[15,12,11,10,"INTEGRATION_NAME"],[15,28,11,26],[16,6,12,4,"setup"],[16,11,12,9],[16,13,12,11,"setup"],[16,14,12,11],[16,19,12,17],[17,8,13,6,"DEBUG_BUILD"],[17,31,13,17],[17,35,13,21,"logger"],[17,47,13,27],[17,48,13,28,"log"],[17,51,13,31],[17,52,13,32],[17,71,13,51],[17,73,13,53,"sidecarUrl"],[17,83,13,63],[17,84,13,64],[18,6,14,4],[18,7,14,5],[19,6,15,4],[20,6,16,4],[21,6,17,4],[22,6,18,4,"processEvent"],[22,18,18,16],[22,20,18,18,"event"],[22,25,18,23],[22,29,18,28,"isSpotlightInteraction"],[22,51,18,50],[22,52,18,51,"event"],[22,57,18,56],[22,58,18,57],[22,61,18,60],[22,65,18,64],[22,68,18,67,"event"],[22,73,18,73],[23,6,19,4,"afterAllSetup"],[23,19,19,17],[23,21,19,20,"client"],[23,27,19,26],[23,31,19,31],[24,8,20,6,"setupSidecarForwarding"],[24,30,20,28],[24,31,20,29,"client"],[24,37,20,35],[24,39,20,37,"sidecarUrl"],[24,49,20,47],[24,50,20,48],[25,6,21,4],[26,4,22,2],[26,5,22,3],[27,2,23,0],[27,3,23,2],[28,2,25,0],[28,11,25,9,"setupSidecarForwarding"],[28,33,25,31,"setupSidecarForwarding"],[28,34,25,32,"client"],[28,40,25,38],[28,42,25,40,"sidecarUrl"],[28,52,25,50],[28,54,25,52],[29,4,26,2],[29,10,26,8,"makeFetch"],[29,19,26,17],[29,22,26,20],[29,26,26,20,"getNativeImplementation"],[29,63,26,43],[29,65,26,44],[29,72,26,51],[29,73,26,52],[30,4,27,2],[30,8,27,6,"failCount"],[30,17,27,15],[30,20,27,18],[30,21,27,19],[31,4,29,2,"client"],[31,10,29,8],[31,11,29,9,"on"],[31,13,29,11],[31,14,29,12],[31,30,29,28],[31,32,29,31,"envelope"],[31,40,29,39],[31,44,29,44],[32,6,30,4],[32,10,30,8,"failCount"],[32,19,30,17],[32,22,30,20],[32,23,30,21],[32,25,30,23],[33,8,31,6,"logger"],[33,20,31,12],[33,21,31,13,"warn"],[33,25,31,17],[33,26,31,18],[33,113,31,105],[33,115,31,107,"failCount"],[33,124,31,116],[33,125,31,117],[34,8,32,6],[35,6,33,4],[36,6,35,4,"makeFetch"],[36,15,35,13],[36,16,35,14,"sidecarUrl"],[36,26,35,24],[36,28,35,26],[37,8,36,6,"method"],[37,14,36,12],[37,16,36,14],[37,22,36,20],[38,8,37,6,"body"],[38,12,37,10],[38,14,37,12],[38,18,37,12,"serializeEnvelope"],[38,41,37,29],[38,43,37,30,"envelope"],[38,51,37,38],[38,52,37,39],[39,8,38,6,"headers"],[39,15,38,13],[39,17,38,15],[40,10,39,8],[40,24,39,22],[40,26,39,24],[41,8,40,6],[41,9,40,7],[42,8,41,6,"mode"],[42,12,41,10],[42,14,41,12],[43,6,42,4],[43,7,42,5],[43,8,42,6],[43,9,42,7,"then"],[43,13,42,11],[43,14,43,6,"res"],[43,17,43,9],[43,21,43,13],[44,8,44,8],[44,12,44,12,"res"],[44,15,44,15],[44,16,44,16,"status"],[44,22,44,22],[44,26,44,26],[44,29,44,29],[44,33,44,33,"res"],[44,36,44,36],[44,37,44,37,"status"],[44,43,44,43],[44,46,44,46],[44,49,44,49],[44,51,44,51],[45,10,45,10],[46,10,46,10,"failCount"],[46,19,46,19],[46,22,46,22],[46,23,46,23],[47,8,47,8],[48,6,48,6],[48,7,48,7],[48,9,49,6,"err"],[48,12,49,9],[48,16,49,13],[49,8,50,8,"failCount"],[49,17,50,17],[49,19,50,19],[50,8,51,8,"logger"],[50,20,51,14],[50,21,51,15,"error"],[50,26,51,20],[50,27,52,10],[50,121,52,104],[50,123,53,10,"err"],[50,126,54,8],[50,127,54,9],[51,6,55,6],[51,7,56,4],[51,8,56,5],[52,4,57,2],[52,5,57,3],[52,6,57,4],[53,2,58,0],[55,2,60,0],[56,0,61,0],[57,0,62,0],[58,0,63,0],[59,0,64,0],[60,2,65,0],[60,8,65,6,"spotlightBrowserIntegration"],[60,35,65,33],[60,38,65,33,"exports"],[60,45,65,33],[60,46,65,33,"spotlightBrowserIntegration"],[60,73,65,33],[60,76,65,36],[60,80,65,36,"defineIntegration"],[60,103,65,53],[60,105,65,54,"_spotlightIntegration"],[60,126,65,75],[60,127,65,76],[62,2,67,0],[63,0,68,0],[64,0,69,0],[65,2,70,0],[65,11,70,9,"isSpotlightInteraction"],[65,33,70,31,"isSpotlightInteraction"],[65,34,70,32,"event"],[65,39,70,37],[65,41,70,39],[66,4,71,2],[66,11,71,9,"Boolean"],[66,18,71,16],[66,19,72,4,"event"],[66,24,72,9],[66,25,72,10,"type"],[66,29,72,14],[66,34,72,19],[66,47,72,32],[66,51,73,6,"event"],[66,56,73,11],[66,57,73,12,"spans"],[66,62,73,17],[66,66,74,6,"event"],[66,71,74,11],[66,72,74,12,"contexts"],[66,80,74,20],[66,84,75,6,"event"],[66,89,75,11],[66,90,75,12,"contexts"],[66,98,75,20],[66,99,75,21,"trace"],[66,104,75,26],[66,108,76,6,"event"],[66,113,76,11],[66,114,76,12,"contexts"],[66,122,76,20],[66,123,76,21,"trace"],[66,128,76,26],[66,129,76,27,"op"],[66,131,76,29],[66,136,76,34],[66,153,76,51],[66,157,77,6,"event"],[66,162,77,11],[66,163,77,12,"spans"],[66,168,77,17],[66,169,77,18,"some"],[66,173,77,22],[66,174,77,23],[66,175,77,24],[67,6,77,26,"description"],[68,4,77,38],[68,5,77,39],[68,10,77,44,"description"],[68,21,77,55],[68,25,77,59,"description"],[68,36,77,70],[68,37,77,71,"includes"],[68,45,77,79],[68,46,77,80],[68,65,77,99],[68,66,77,100],[68,67,78,2],[68,68,78,3],[69,2,79,0],[70,0,79,1],[70,3]],"functionMap":{"names":["<global>","_spotlightIntegration","setup","processEvent","afterAllSetup","setupSidecarForwarding","client.on$argument_1","makeFetch.then$argument_0","makeFetch.then$argument_1","isSpotlightInteraction","event.spans.some$argument_0"],"mappings":"AAA;+BCM;WCK;KDE;kBEI,uDF;mBGC;KHE;CDE;AKE;8BCI;MCc;ODK;MEC;OFM;GDE;CLC;ASY;uBCO,6ED;CTE"}},"type":"js/module"}]}