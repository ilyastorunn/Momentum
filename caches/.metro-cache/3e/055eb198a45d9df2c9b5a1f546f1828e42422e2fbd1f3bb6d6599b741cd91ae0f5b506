{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":99,"index":99}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"]}},{"name":"../types.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":100},"end":{"line":2,"column":37,"index":137}}],"key":"8cLkkKYebhz8179+ortY3/pylDg=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.addHistoryInstrumentationHandler = addHistoryInstrumentationHandler;\n  var _core = require(_dependencyMap[0], \"@sentry/core\");\n  var _types = require(_dependencyMap[1], \"../types.js\");\n  let lastHref;\n\n  /**\n   * Add an instrumentation handler for when a fetch request happens.\n   * The handler function is called once when the request starts and once when it ends,\n   * which can be identified by checking if it has an `endTimestamp`.\n   *\n   * Use at your own risk, this might break without changelog notice, only used internally.\n   * @hidden\n   */\n  function addHistoryInstrumentationHandler(handler) {\n    const type = 'history';\n    (0, _core.addHandler)(type, handler);\n    (0, _core.maybeInstrument)(type, instrumentHistory);\n  }\n  function instrumentHistory() {\n    if (!(0, _core.supportsHistory)()) {\n      return;\n    }\n    const oldOnPopState = _types.WINDOW.onpopstate;\n    _types.WINDOW.onpopstate = function (...args) {\n      const to = _types.WINDOW.location.href;\n      // keep track of the current URL state, as we always receive only the updated state\n      const from = lastHref;\n      lastHref = to;\n      const handlerData = {\n        from,\n        to\n      };\n      (0, _core.triggerHandlers)('history', handlerData);\n      if (oldOnPopState) {\n        // Apparently this can throw in Firefox when incorrectly implemented plugin is installed.\n        // https://github.com/getsentry/sentry-javascript/issues/3344\n        // https://github.com/bugsnag/bugsnag-js/issues/469\n        try {\n          return oldOnPopState.apply(this, args);\n        } catch (_oO) {\n          // no-empty\n        }\n      }\n    };\n    function historyReplacementFunction(originalHistoryFunction) {\n      return function (...args) {\n        const url = args.length > 2 ? args[2] : undefined;\n        if (url) {\n          // coerce to string (this is what pushState does)\n          const from = lastHref;\n          const to = String(url);\n          // keep track of the current URL state, as we always receive only the updated state\n          lastHref = to;\n          const handlerData = {\n            from,\n            to\n          };\n          (0, _core.triggerHandlers)('history', handlerData);\n        }\n        return originalHistoryFunction.apply(this, args);\n      };\n    }\n    (0, _core.fill)(_types.WINDOW.history, 'pushState', historyReplacementFunction);\n    (0, _core.fill)(_types.WINDOW.history, 'replaceState', historyReplacementFunction);\n  }\n});","lineCount":70,"map":[[6,2,1,0],[6,6,1,0,"_core"],[6,11,1,0],[6,14,1,0,"require"],[6,21,1,0],[6,22,1,0,"_dependencyMap"],[6,36,1,0],[7,2,2,0],[7,6,2,0,"_types"],[7,12,2,0],[7,15,2,0,"require"],[7,22,2,0],[7,23,2,0,"_dependencyMap"],[7,37,2,0],[8,2,4,0],[8,6,4,4,"lastHref"],[8,14,4,12],[10,2,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,0,13,0],[18,2,14,0],[18,11,14,9,"addHistoryInstrumentationHandler"],[18,43,14,41,"addHistoryInstrumentationHandler"],[18,44,14,42,"handler"],[18,51,14,49],[18,53,14,51],[19,4,15,2],[19,10,15,8,"type"],[19,14,15,12],[19,17,15,15],[19,26,15,24],[20,4,16,2],[20,8,16,2,"addHandler"],[20,24,16,12],[20,26,16,13,"type"],[20,30,16,17],[20,32,16,19,"handler"],[20,39,16,26],[20,40,16,27],[21,4,17,2],[21,8,17,2,"maybeInstrument"],[21,29,17,17],[21,31,17,18,"type"],[21,35,17,22],[21,37,17,24,"instrumentHistory"],[21,54,17,41],[21,55,17,42],[22,2,18,0],[23,2,20,0],[23,11,20,9,"instrumentHistory"],[23,28,20,26,"instrumentHistory"],[23,29,20,26],[23,31,20,29],[24,4,21,2],[24,8,21,6],[24,9,21,7],[24,13,21,7,"supportsHistory"],[24,34,21,22],[24,36,21,23],[24,37,21,24],[24,39,21,26],[25,6,22,4],[26,4,23,2],[27,4,25,2],[27,10,25,8,"oldOnPopState"],[27,23,25,21],[27,26,25,24,"WINDOW"],[27,39,25,30],[27,40,25,31,"onpopstate"],[27,50,25,41],[28,4,26,2,"WINDOW"],[28,17,26,8],[28,18,26,9,"onpopstate"],[28,28,26,19],[28,31,26,22],[28,41,26,33],[28,44,26,36,"args"],[28,48,26,40],[28,50,26,42],[29,6,27,4],[29,12,27,10,"to"],[29,14,27,12],[29,17,27,15,"WINDOW"],[29,30,27,21],[29,31,27,22,"location"],[29,39,27,30],[29,40,27,31,"href"],[29,44,27,35],[30,6,28,4],[31,6,29,4],[31,12,29,10,"from"],[31,16,29,14],[31,19,29,17,"lastHref"],[31,27,29,25],[32,6,30,4,"lastHref"],[32,14,30,12],[32,17,30,15,"to"],[32,19,30,17],[33,6,31,4],[33,12,31,10,"handlerData"],[33,23,31,21],[33,26,31,24],[34,8,31,26,"from"],[34,12,31,30],[35,8,31,32,"to"],[36,6,31,35],[36,7,31,36],[37,6,32,4],[37,10,32,4,"triggerHandlers"],[37,31,32,19],[37,33,32,20],[37,42,32,29],[37,44,32,31,"handlerData"],[37,55,32,42],[37,56,32,43],[38,6,33,4],[38,10,33,8,"oldOnPopState"],[38,23,33,21],[38,25,33,23],[39,8,34,6],[40,8,35,6],[41,8,36,6],[42,8,37,6],[42,12,37,10],[43,10,38,8],[43,17,38,15,"oldOnPopState"],[43,30,38,28],[43,31,38,29,"apply"],[43,36,38,34],[43,37,38,35],[43,41,38,39],[43,43,38,41,"args"],[43,47,38,45],[43,48,38,46],[44,8,39,6],[44,9,39,7],[44,10,39,8],[44,17,39,15,"_oO"],[44,20,39,18],[44,22,39,20],[45,10,40,8],[46,8,40,8],[47,6,42,4],[48,4,43,2],[48,5,43,3],[49,4,45,2],[49,13,45,11,"historyReplacementFunction"],[49,39,45,37,"historyReplacementFunction"],[49,40,45,38,"originalHistoryFunction"],[49,63,45,61],[49,65,45,63],[50,6,46,4],[50,13,46,11],[50,23,46,22],[50,26,46,25,"args"],[50,30,46,29],[50,32,46,31],[51,8,47,6],[51,14,47,12,"url"],[51,17,47,15],[51,20,47,18,"args"],[51,24,47,22],[51,25,47,23,"length"],[51,31,47,29],[51,34,47,32],[51,35,47,33],[51,38,47,36,"args"],[51,42,47,40],[51,43,47,41],[51,44,47,42],[51,45,47,43],[51,48,47,46,"undefined"],[51,57,47,55],[52,8,48,6],[52,12,48,10,"url"],[52,15,48,13],[52,17,48,15],[53,10,49,8],[54,10,50,8],[54,16,50,14,"from"],[54,20,50,18],[54,23,50,21,"lastHref"],[54,31,50,29],[55,10,51,8],[55,16,51,14,"to"],[55,18,51,16],[55,21,51,19,"String"],[55,27,51,25],[55,28,51,26,"url"],[55,31,51,29],[55,32,51,30],[56,10,52,8],[57,10,53,8,"lastHref"],[57,18,53,16],[57,21,53,19,"to"],[57,23,53,21],[58,10,54,8],[58,16,54,14,"handlerData"],[58,27,54,25],[58,30,54,28],[59,12,54,30,"from"],[59,16,54,34],[60,12,54,36,"to"],[61,10,54,39],[61,11,54,40],[62,10,55,8],[62,14,55,8,"triggerHandlers"],[62,35,55,23],[62,37,55,24],[62,46,55,33],[62,48,55,35,"handlerData"],[62,59,55,46],[62,60,55,47],[63,8,56,6],[64,8,57,6],[64,15,57,13,"originalHistoryFunction"],[64,38,57,36],[64,39,57,37,"apply"],[64,44,57,42],[64,45,57,43],[64,49,57,47],[64,51,57,49,"args"],[64,55,57,53],[64,56,57,54],[65,6,58,4],[65,7,58,5],[66,4,59,2],[67,4,61,2],[67,8,61,2,"fill"],[67,18,61,6],[67,20,61,7,"WINDOW"],[67,33,61,13],[67,34,61,14,"history"],[67,41,61,21],[67,43,61,23],[67,54,61,34],[67,56,61,36,"historyReplacementFunction"],[67,82,61,62],[67,83,61,63],[68,4,62,2],[68,8,62,2,"fill"],[68,18,62,6],[68,20,62,7,"WINDOW"],[68,33,62,13],[68,34,62,14,"history"],[68,41,62,21],[68,43,62,23],[68,57,62,37],[68,59,62,39,"historyReplacementFunction"],[68,85,62,65],[68,86,62,66],[69,2,63,0],[70,0,63,1],[70,3]],"functionMap":{"names":["<global>","addHistoryInstrumentationHandler","instrumentHistory","WINDOW.onpopstate","historyReplacementFunction","<anonymous>"],"mappings":"AAA;ACa;CDI;AEE;sBCM;GDiB;EEE;WCC;KDY;GFC;CFI"}},"type":"js/module"}]}