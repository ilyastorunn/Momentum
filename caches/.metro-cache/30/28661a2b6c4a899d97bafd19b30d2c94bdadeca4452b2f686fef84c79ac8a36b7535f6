{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":361,"index":361}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"]}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":362},"end":{"line":2,"column":48,"index":410}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"]}},{"name":"./instrument.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":411},"end":{"line":3,"column":63,"index":474}}],"key":"/faGONMhKrqQj2KSLxxwco89Hvc=","exportNames":["*"]}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":475},"end":{"line":4,"column":66,"index":541}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"]}},{"name":"./web-vitals/lib/onHidden.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":542},"end":{"line":5,"column":56,"index":598}}],"key":"FjgfcDpol5/qMWLY/A/RHFWv6pg=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.trackClsAsStandaloneSpan = trackClsAsStandaloneSpan;\n  var _core = require(_dependencyMap[0], \"@sentry/core\");\n  var _debugBuild = require(_dependencyMap[1], \"../debug-build.js\");\n  var _instrument = require(_dependencyMap[2], \"./instrument.js\");\n  var _utils = require(_dependencyMap[3], \"./utils.js\");\n  var _onHidden = require(_dependencyMap[4], \"./web-vitals/lib/onHidden.js\");\n  /**\n   * Starts tracking the Cumulative Layout Shift on the current page and collects the value once\n   *\n   * - the page visibility is hidden\n   * - a navigation span is started (to stop CLS measurement for SPA soft navigations)\n   *\n   * Once either of these events triggers, the CLS value is sent as a standalone span and we stop\n   * measuring CLS.\n   */\n  function trackClsAsStandaloneSpan() {\n    let standaloneCLsValue = 0;\n    let standaloneClsEntry;\n    let pageloadSpanId;\n    if (!supportsLayoutShift()) {\n      return;\n    }\n    let sentSpan = false;\n    function _collectClsOnce() {\n      if (sentSpan) {\n        return;\n      }\n      sentSpan = true;\n      if (pageloadSpanId) {\n        sendStandaloneClsSpan(standaloneCLsValue, standaloneClsEntry, pageloadSpanId);\n      }\n      cleanupClsHandler();\n    }\n    const cleanupClsHandler = (0, _instrument.addClsInstrumentationHandler)(({\n      metric\n    }) => {\n      const entry = metric.entries[metric.entries.length - 1];\n      if (!entry) {\n        return;\n      }\n      standaloneCLsValue = metric.value;\n      standaloneClsEntry = entry;\n    }, true);\n\n    // use pagehide event from web-vitals\n    (0, _onHidden.onHidden)(() => {\n      _collectClsOnce();\n    });\n\n    // Since the call chain of this function is synchronous and evaluates before the SDK client is created,\n    // we need to wait with subscribing to a client hook until the client is created. Therefore, we defer\n    // to the next tick after the SDK setup.\n    setTimeout(() => {\n      const client = (0, _core.getClient)();\n      if (!client) {\n        return;\n      }\n      const unsubscribeStartNavigation = client.on('startNavigationSpan', () => {\n        _collectClsOnce();\n        unsubscribeStartNavigation && unsubscribeStartNavigation();\n      });\n      const activeSpan = (0, _core.getActiveSpan)();\n      const rootSpan = activeSpan && (0, _core.getRootSpan)(activeSpan);\n      const spanJSON = rootSpan && (0, _core.spanToJSON)(rootSpan);\n      if (spanJSON && spanJSON.op === 'pageload') {\n        pageloadSpanId = rootSpan.spanContext().spanId;\n      }\n    }, 0);\n  }\n  function sendStandaloneClsSpan(clsValue, entry, pageloadSpanId) {\n    _debugBuild.DEBUG_BUILD && _core.logger.log(`Sending CLS span (${clsValue})`);\n    const startTime = (0, _utils.msToSec)((_core.browserPerformanceTimeOrigin || 0) + (entry && entry.startTime || 0));\n    const routeName = (0, _core.getCurrentScope)().getScopeData().transactionName;\n    const name = entry ? (0, _core.htmlTreeAsString)(entry.sources[0] && entry.sources[0].node) : 'Layout shift';\n    const attributes = (0, _core.dropUndefinedKeys)({\n      [_core.SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.http.browser.cls',\n      [_core.SEMANTIC_ATTRIBUTE_SENTRY_OP]: 'ui.webvital.cls',\n      [_core.SEMANTIC_ATTRIBUTE_EXCLUSIVE_TIME]: entry && entry.duration || 0,\n      // attach the pageload span id to the CLS span so that we can link them in the UI\n      'sentry.pageload.span_id': pageloadSpanId\n    });\n    const span = (0, _utils.startStandaloneWebVitalSpan)({\n      name,\n      transaction: routeName,\n      attributes,\n      startTime\n    });\n    if (span) {\n      span.addEvent('cls', {\n        [_core.SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_UNIT]: '',\n        [_core.SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_VALUE]: clsValue\n      });\n\n      // LayoutShift performance entries always have a duration of 0, so we don't need to add `entry.duration` here\n      // see: https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry/duration\n      span.end(startTime);\n    }\n  }\n  function supportsLayoutShift() {\n    try {\n      return PerformanceObserver.supportedEntryTypes.includes('layout-shift');\n    } catch (e) {\n      return false;\n    }\n  }\n});","lineCount":110,"map":[[6,2,1,0],[6,6,1,0,"_core"],[6,11,1,0],[6,14,1,0,"require"],[6,21,1,0],[6,22,1,0,"_dependencyMap"],[6,36,1,0],[7,2,2,0],[7,6,2,0,"_debugBuild"],[7,17,2,0],[7,20,2,0,"require"],[7,27,2,0],[7,28,2,0,"_dependencyMap"],[7,42,2,0],[8,2,3,0],[8,6,3,0,"_instrument"],[8,17,3,0],[8,20,3,0,"require"],[8,27,3,0],[8,28,3,0,"_dependencyMap"],[8,42,3,0],[9,2,4,0],[9,6,4,0,"_utils"],[9,12,4,0],[9,15,4,0,"require"],[9,22,4,0],[9,23,4,0,"_dependencyMap"],[9,37,4,0],[10,2,5,0],[10,6,5,0,"_onHidden"],[10,15,5,0],[10,18,5,0,"require"],[10,25,5,0],[10,26,5,0,"_dependencyMap"],[10,40,5,0],[11,2,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,0,13,0],[18,0,14,0],[19,0,15,0],[20,2,16,0],[20,11,16,9,"trackClsAsStandaloneSpan"],[20,35,16,33,"trackClsAsStandaloneSpan"],[20,36,16,33],[20,38,16,36],[21,4,17,2],[21,8,17,6,"standaloneCLsValue"],[21,26,17,24],[21,29,17,27],[21,30,17,28],[22,4,18,2],[22,8,18,6,"standaloneClsEntry"],[22,26,18,24],[23,4,19,2],[23,8,19,6,"pageloadSpanId"],[23,22,19,20],[24,4,21,2],[24,8,21,6],[24,9,21,7,"supportsLayoutShift"],[24,28,21,26],[24,29,21,27],[24,30,21,28],[24,32,21,30],[25,6,22,4],[26,4,23,2],[27,4,25,2],[27,8,25,6,"sentSpan"],[27,16,25,14],[27,19,25,17],[27,24,25,22],[28,4,26,2],[28,13,26,11,"_collectClsOnce"],[28,28,26,26,"_collectClsOnce"],[28,29,26,26],[28,31,26,29],[29,6,27,4],[29,10,27,8,"sentSpan"],[29,18,27,16],[29,20,27,18],[30,8,28,6],[31,6,29,4],[32,6,30,4,"sentSpan"],[32,14,30,12],[32,17,30,15],[32,21,30,19],[33,6,31,4],[33,10,31,8,"pageloadSpanId"],[33,24,31,22],[33,26,31,24],[34,8,32,6,"sendStandaloneClsSpan"],[34,29,32,27],[34,30,32,28,"standaloneCLsValue"],[34,48,32,46],[34,50,32,48,"standaloneClsEntry"],[34,68,32,66],[34,70,32,68,"pageloadSpanId"],[34,84,32,82],[34,85,32,83],[35,6,33,4],[36,6,34,4,"cleanupClsHandler"],[36,23,34,21],[36,24,34,22],[36,25,34,23],[37,4,35,2],[38,4,37,2],[38,10,37,8,"cleanupClsHandler"],[38,27,37,25],[38,30,37,28],[38,34,37,28,"addClsInstrumentationHandler"],[38,74,37,56],[38,76,37,57],[38,77,37,58],[39,6,37,60,"metric"],[40,4,37,67],[40,5,37,68],[40,10,37,73],[41,6,38,4],[41,12,38,10,"entry"],[41,17,38,15],[41,20,38,18,"metric"],[41,26,38,24],[41,27,38,25,"entries"],[41,34,38,32],[41,35,38,33,"metric"],[41,41,38,39],[41,42,38,40,"entries"],[41,49,38,47],[41,50,38,48,"length"],[41,56,38,54],[41,59,38,57],[41,60,38,58],[41,61,38,59],[42,6,39,4],[42,10,39,8],[42,11,39,9,"entry"],[42,16,39,14],[42,18,39,16],[43,8,40,6],[44,6,41,4],[45,6,42,4,"standaloneCLsValue"],[45,24,42,22],[45,27,42,25,"metric"],[45,33,42,31],[45,34,42,32,"value"],[45,39,42,37],[46,6,43,4,"standaloneClsEntry"],[46,24,43,22],[46,27,43,25,"entry"],[46,32,43,30],[47,4,44,2],[47,5,44,3],[47,7,44,5],[47,11,44,9],[47,12,44,10],[49,4,46,2],[50,4,47,2],[50,8,47,2,"onHidden"],[50,26,47,10],[50,28,47,11],[50,34,47,17],[51,6,48,4,"_collectClsOnce"],[51,21,48,19],[51,22,48,20],[51,23,48,21],[52,4,49,2],[52,5,49,3],[52,6,49,4],[54,4,51,2],[55,4,52,2],[56,4,53,2],[57,4,54,2,"setTimeout"],[57,14,54,12],[57,15,54,13],[57,21,54,19],[58,6,55,4],[58,12,55,10,"client"],[58,18,55,16],[58,21,55,19],[58,25,55,19,"getClient"],[58,40,55,28],[58,42,55,29],[58,43,55,30],[59,6,57,4],[59,10,57,8],[59,11,57,9,"client"],[59,17,57,15],[59,19,57,17],[60,8,58,6],[61,6,59,4],[62,6,61,4],[62,12,61,10,"unsubscribeStartNavigation"],[62,38,61,36],[62,41,61,39,"client"],[62,47,61,45],[62,48,61,46,"on"],[62,50,61,48],[62,51,61,49],[62,72,61,70],[62,74,61,72],[62,80,61,78],[63,8,62,6,"_collectClsOnce"],[63,23,62,21],[63,24,62,22],[63,25,62,23],[64,8,63,6,"unsubscribeStartNavigation"],[64,34,63,32],[64,38,63,36,"unsubscribeStartNavigation"],[64,64,63,62],[64,65,63,63],[64,66,63,64],[65,6,64,4],[65,7,64,5],[65,8,64,6],[66,6,66,4],[66,12,66,10,"activeSpan"],[66,22,66,20],[66,25,66,23],[66,29,66,23,"getActiveSpan"],[66,48,66,36],[66,50,66,37],[66,51,66,38],[67,6,67,4],[67,12,67,10,"rootSpan"],[67,20,67,18],[67,23,67,21,"activeSpan"],[67,33,67,31],[67,37,67,35],[67,41,67,35,"getRootSpan"],[67,58,67,46],[67,60,67,47,"activeSpan"],[67,70,67,57],[67,71,67,58],[68,6,68,4],[68,12,68,10,"spanJSON"],[68,20,68,18],[68,23,68,21,"rootSpan"],[68,31,68,29],[68,35,68,33],[68,39,68,33,"spanToJSON"],[68,55,68,43],[68,57,68,44,"rootSpan"],[68,65,68,52],[68,66,68,53],[69,6,69,4],[69,10,69,8,"spanJSON"],[69,18,69,16],[69,22,69,20,"spanJSON"],[69,30,69,28],[69,31,69,29,"op"],[69,33,69,31],[69,38,69,36],[69,48,69,46],[69,50,69,48],[70,8,70,6,"pageloadSpanId"],[70,22,70,20],[70,25,70,23,"rootSpan"],[70,33,70,31],[70,34,70,32,"spanContext"],[70,45,70,43],[70,46,70,44],[70,47,70,45],[70,48,70,46,"spanId"],[70,54,70,52],[71,6,71,4],[72,4,72,2],[72,5,72,3],[72,7,72,5],[72,8,72,6],[72,9,72,7],[73,2,73,0],[74,2,75,0],[74,11,75,9,"sendStandaloneClsSpan"],[74,32,75,30,"sendStandaloneClsSpan"],[74,33,75,31,"clsValue"],[74,41,75,39],[74,43,75,41,"entry"],[74,48,75,46],[74,50,75,48,"pageloadSpanId"],[74,64,75,62],[74,66,75,64],[75,4,76,2,"DEBUG_BUILD"],[75,27,76,13],[75,31,76,17,"logger"],[75,43,76,23],[75,44,76,24,"log"],[75,47,76,27],[75,48,76,28],[75,69,76,49,"clsValue"],[75,77,76,57],[75,80,76,60],[75,81,76,61],[76,4,78,2],[76,10,78,8,"startTime"],[76,19,78,17],[76,22,78,20],[76,26,78,20,"msToSec"],[76,40,78,27],[76,42,78,28],[76,43,78,29,"browserPerformanceTimeOrigin"],[76,77,78,57],[76,81,78,61],[76,82,78,62],[76,87,78,68,"entry"],[76,92,78,73],[76,96,78,77,"entry"],[76,101,78,82],[76,102,78,83,"startTime"],[76,111,78,92],[76,115,78,97],[76,116,78,98],[76,117,78,99],[76,118,78,100],[77,4,79,2],[77,10,79,8,"routeName"],[77,19,79,17],[77,22,79,20],[77,26,79,20,"getCurrentScope"],[77,47,79,35],[77,49,79,36],[77,50,79,37],[77,51,79,38,"getScopeData"],[77,63,79,50],[77,64,79,51],[77,65,79,52],[77,66,79,53,"transactionName"],[77,81,79,68],[78,4,81,2],[78,10,81,8,"name"],[78,14,81,12],[78,17,81,15,"entry"],[78,22,81,20],[78,25,81,23],[78,29,81,23,"htmlTreeAsString"],[78,51,81,39],[78,53,81,40,"entry"],[78,58,81,45],[78,59,81,46,"sources"],[78,66,81,53],[78,67,81,54],[78,68,81,55],[78,69,81,56],[78,73,81,60,"entry"],[78,78,81,65],[78,79,81,66,"sources"],[78,86,81,73],[78,87,81,74],[78,88,81,75],[78,89,81,76],[78,90,81,77,"node"],[78,94,81,81],[78,95,81,82],[78,98,81,85],[78,112,81,99],[79,4,83,2],[79,10,83,8,"attributes"],[79,20,83,18],[79,23,83,21],[79,27,83,21,"dropUndefinedKeys"],[79,50,83,38],[79,52,83,39],[80,6,84,4],[80,7,84,5,"SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN"],[80,45,84,37],[80,48,84,40],[80,71,84,63],[81,6,85,4],[81,7,85,5,"SEMANTIC_ATTRIBUTE_SENTRY_OP"],[81,41,85,33],[81,44,85,36],[81,61,85,53],[82,6,86,4],[82,7,86,5,"SEMANTIC_ATTRIBUTE_EXCLUSIVE_TIME"],[82,46,86,38],[82,49,86,42,"entry"],[82,54,86,47],[82,58,86,51,"entry"],[82,63,86,56],[82,64,86,57,"duration"],[82,72,86,65],[82,76,86,70],[82,77,86,71],[83,6,87,4],[84,6,88,4],[84,31,88,29],[84,33,88,31,"pageloadSpanId"],[85,4,89,2],[85,5,89,3],[85,6,89,4],[86,4,91,2],[86,10,91,8,"span"],[86,14,91,12],[86,17,91,15],[86,21,91,15,"startStandaloneWebVitalSpan"],[86,55,91,42],[86,57,91,43],[87,6,92,4,"name"],[87,10,92,8],[88,6,93,4,"transaction"],[88,17,93,15],[88,19,93,17,"routeName"],[88,28,93,26],[89,6,94,4,"attributes"],[89,16,94,14],[90,6,95,4,"startTime"],[91,4,96,2],[91,5,96,3],[91,6,96,4],[92,4,98,2],[92,8,98,6,"span"],[92,12,98,10],[92,14,98,12],[93,6,99,4,"span"],[93,10,99,8],[93,11,99,9,"addEvent"],[93,19,99,17],[93,20,99,18],[93,25,99,23],[93,27,99,25],[94,8,100,6],[94,9,100,7,"SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_UNIT"],[94,57,100,49],[94,60,100,52],[94,62,100,54],[95,8,101,6],[95,9,101,7,"SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_VALUE"],[95,58,101,50],[95,61,101,53,"clsValue"],[96,6,102,4],[96,7,102,5],[96,8,102,6],[98,6,104,4],[99,6,105,4],[100,6,106,4,"span"],[100,10,106,8],[100,11,106,9,"end"],[100,14,106,12],[100,15,106,13,"startTime"],[100,24,106,22],[100,25,106,23],[101,4,107,2],[102,2,108,0],[103,2,110,0],[103,11,110,9,"supportsLayoutShift"],[103,30,110,28,"supportsLayoutShift"],[103,31,110,28],[103,33,110,31],[104,4,111,2],[104,8,111,6],[105,6,112,4],[105,13,112,11,"PerformanceObserver"],[105,32,112,30],[105,33,112,31,"supportedEntryTypes"],[105,52,112,50],[105,53,112,51,"includes"],[105,61,112,59],[105,62,112,60],[105,76,112,74],[105,77,112,75],[106,4,113,2],[106,5,113,3],[106,6,113,4],[106,13,113,11,"e"],[106,14,113,12],[106,16,113,14],[107,6,114,4],[107,13,114,11],[107,18,114,16],[108,4,115,2],[109,2,116,0],[110,0,116,1],[110,3]],"functionMap":{"names":["<global>","trackClsAsStandaloneSpan","_collectClsOnce","addClsInstrumentationHandler$argument_0","onHidden$argument_0","setTimeout$argument_0","client.on$argument_1","sendStandaloneClsSpan","supportsLayoutShift"],"mappings":"AAA;ACe;ECU;GDS;yDEE;GFO;WGG;GHE;aIK;wECO;KDG;GJQ;CDC;AOE;CPiC;AQE;CRM"}},"type":"js/module"}]}