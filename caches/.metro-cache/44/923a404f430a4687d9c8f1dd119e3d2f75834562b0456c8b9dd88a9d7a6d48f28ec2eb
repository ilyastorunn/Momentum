{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":85,"index":85}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"]}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":86},"end":{"line":2,"column":48,"index":134}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"]}},{"name":"./startProfileForSpan.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":135},"end":{"line":3,"column":63,"index":198}}],"key":"TzywuMgogXTTTnhuIvWyUl40448=","exportNames":["*"]}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":199},"end":{"line":4,"column":207,"index":406}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.browserProfilingIntegration = void 0;\n  var _core = require(_dependencyMap[0], \"@sentry/core\");\n  var _debugBuild = require(_dependencyMap[1], \"../debug-build.js\");\n  var _startProfileForSpan = require(_dependencyMap[2], \"./startProfileForSpan.js\");\n  var _utils = require(_dependencyMap[3], \"./utils.js\");\n  const INTEGRATION_NAME = 'BrowserProfiling';\n  const _browserProfilingIntegration = () => {\n    return {\n      name: INTEGRATION_NAME,\n      setup(client) {\n        const activeSpan = (0, _core.getActiveSpan)();\n        const rootSpan = activeSpan && (0, _core.getRootSpan)(activeSpan);\n        if (rootSpan && (0, _utils.isAutomatedPageLoadSpan)(rootSpan)) {\n          if ((0, _utils.shouldProfileSpan)(rootSpan)) {\n            (0, _startProfileForSpan.startProfileForSpan)(rootSpan);\n          }\n        }\n        client.on('spanStart', span => {\n          if (span === (0, _core.getRootSpan)(span) && (0, _utils.shouldProfileSpan)(span)) {\n            (0, _startProfileForSpan.startProfileForSpan)(span);\n          }\n        });\n        client.on('beforeEnvelope', envelope => {\n          // if not profiles are in queue, there is nothing to add to the envelope.\n          if (!(0, _utils.getActiveProfilesCount)()) {\n            return;\n          }\n          const profiledTransactionEvents = (0, _utils.findProfiledTransactionsFromEnvelope)(envelope);\n          if (!profiledTransactionEvents.length) {\n            return;\n          }\n          const profilesToAddToEnvelope = [];\n          for (const profiledTransaction of profiledTransactionEvents) {\n            const context = profiledTransaction && profiledTransaction.contexts;\n            const profile_id = context && context['profile'] && context['profile']['profile_id'];\n            const start_timestamp = context && context['profile'] && context['profile']['start_timestamp'];\n            if (typeof profile_id !== 'string') {\n              _debugBuild.DEBUG_BUILD && _core.logger.log('[Profiling] cannot find profile for a span without a profile context');\n              continue;\n            }\n            if (!profile_id) {\n              _debugBuild.DEBUG_BUILD && _core.logger.log('[Profiling] cannot find profile for a span without a profile context');\n              continue;\n            }\n\n            // Remove the profile from the span context before sending, relay will take care of the rest.\n            if (context && context['profile']) {\n              delete context.profile;\n            }\n            const profile = (0, _utils.takeProfileFromGlobalCache)(profile_id);\n            if (!profile) {\n              _debugBuild.DEBUG_BUILD && _core.logger.log(`[Profiling] Could not retrieve profile for span: ${profile_id}`);\n              continue;\n            }\n            const profileEvent = (0, _utils.createProfilingEvent)(profile_id, start_timestamp, profile, profiledTransaction);\n            if (profileEvent) {\n              profilesToAddToEnvelope.push(profileEvent);\n            }\n          }\n          (0, _utils.addProfilesToEnvelope)(envelope, profilesToAddToEnvelope);\n        });\n      }\n    };\n  };\n  const browserProfilingIntegration = exports.browserProfilingIntegration = (0, _core.defineIntegration)(_browserProfilingIntegration);\n});","lineCount":70,"map":[[6,2,1,0],[6,6,1,0,"_core"],[6,11,1,0],[6,14,1,0,"require"],[6,21,1,0],[6,22,1,0,"_dependencyMap"],[6,36,1,0],[7,2,2,0],[7,6,2,0,"_debugBuild"],[7,17,2,0],[7,20,2,0,"require"],[7,27,2,0],[7,28,2,0,"_dependencyMap"],[7,42,2,0],[8,2,3,0],[8,6,3,0,"_startProfileForSpan"],[8,26,3,0],[8,29,3,0,"require"],[8,36,3,0],[8,37,3,0,"_dependencyMap"],[8,51,3,0],[9,2,4,0],[9,6,4,0,"_utils"],[9,12,4,0],[9,15,4,0,"require"],[9,22,4,0],[9,23,4,0,"_dependencyMap"],[9,37,4,0],[10,2,6,0],[10,8,6,6,"INTEGRATION_NAME"],[10,24,6,22],[10,27,6,25],[10,45,6,43],[11,2,8,0],[11,8,8,6,"_browserProfilingIntegration"],[11,36,8,34],[11,39,8,38,"_browserProfilingIntegration"],[11,40,8,38],[11,45,8,44],[12,4,9,2],[12,11,9,9],[13,6,10,4,"name"],[13,10,10,8],[13,12,10,10,"INTEGRATION_NAME"],[13,28,10,26],[14,6,11,4,"setup"],[14,11,11,9,"setup"],[14,12,11,10,"client"],[14,18,11,16],[14,20,11,18],[15,8,12,6],[15,14,12,12,"activeSpan"],[15,24,12,22],[15,27,12,25],[15,31,12,25,"getActiveSpan"],[15,50,12,38],[15,52,12,39],[15,53,12,40],[16,8,13,6],[16,14,13,12,"rootSpan"],[16,22,13,20],[16,25,13,23,"activeSpan"],[16,35,13,33],[16,39,13,37],[16,43,13,37,"getRootSpan"],[16,60,13,48],[16,62,13,49,"activeSpan"],[16,72,13,59],[16,73,13,60],[17,8,15,6],[17,12,15,10,"rootSpan"],[17,20,15,18],[17,24,15,22],[17,28,15,22,"isAutomatedPageLoadSpan"],[17,58,15,45],[17,60,15,46,"rootSpan"],[17,68,15,54],[17,69,15,55],[17,71,15,57],[18,10,16,8],[18,14,16,12],[18,18,16,12,"shouldProfileSpan"],[18,42,16,29],[18,44,16,30,"rootSpan"],[18,52,16,38],[18,53,16,39],[18,55,16,41],[19,12,17,10],[19,16,17,10,"startProfileForSpan"],[19,56,17,29],[19,58,17,30,"rootSpan"],[19,66,17,38],[19,67,17,39],[20,10,18,8],[21,8,19,6],[22,8,21,6,"client"],[22,14,21,12],[22,15,21,13,"on"],[22,17,21,15],[22,18,21,16],[22,29,21,27],[22,31,21,30,"span"],[22,35,21,34],[22,39,21,39],[23,10,22,8],[23,14,22,12,"span"],[23,18,22,16],[23,23,22,21],[23,27,22,21,"getRootSpan"],[23,44,22,32],[23,46,22,33,"span"],[23,50,22,37],[23,51,22,38],[23,55,22,42],[23,59,22,42,"shouldProfileSpan"],[23,83,22,59],[23,85,22,60,"span"],[23,89,22,64],[23,90,22,65],[23,92,22,67],[24,12,23,10],[24,16,23,10,"startProfileForSpan"],[24,56,23,29],[24,58,23,30,"span"],[24,62,23,34],[24,63,23,35],[25,10,24,8],[26,8,25,6],[26,9,25,7],[26,10,25,8],[27,8,27,6,"client"],[27,14,27,12],[27,15,27,13,"on"],[27,17,27,15],[27,18,27,16],[27,34,27,32],[27,36,27,35,"envelope"],[27,44,27,43],[27,48,27,48],[28,10,28,8],[29,10,29,8],[29,14,29,12],[29,15,29,13],[29,19,29,13,"getActiveProfilesCount"],[29,48,29,35],[29,50,29,36],[29,51,29,37],[29,53,29,39],[30,12,30,10],[31,10,31,8],[32,10,33,8],[32,16,33,14,"profiledTransactionEvents"],[32,41,33,39],[32,44,33,42],[32,48,33,42,"findProfiledTransactionsFromEnvelope"],[32,91,33,78],[32,93,33,79,"envelope"],[32,101,33,87],[32,102,33,88],[33,10,34,8],[33,14,34,12],[33,15,34,13,"profiledTransactionEvents"],[33,40,34,38],[33,41,34,39,"length"],[33,47,34,45],[33,49,34,47],[34,12,35,10],[35,10,36,8],[36,10,38,8],[36,16,38,14,"profilesToAddToEnvelope"],[36,39,38,37],[36,42,38,40],[36,44,38,42],[37,10,40,8],[37,15,40,13],[37,21,40,19,"profiledTransaction"],[37,40,40,38],[37,44,40,42,"profiledTransactionEvents"],[37,69,40,67],[37,71,40,69],[38,12,41,10],[38,18,41,16,"context"],[38,25,41,23],[38,28,41,26,"profiledTransaction"],[38,47,41,45],[38,51,41,49,"profiledTransaction"],[38,70,41,68],[38,71,41,69,"contexts"],[38,79,41,77],[39,12,42,10],[39,18,42,16,"profile_id"],[39,28,42,26],[39,31,42,29,"context"],[39,38,42,36],[39,42,42,40,"context"],[39,49,42,47],[39,50,42,48],[39,59,42,57],[39,60,42,58],[39,64,42,62,"context"],[39,71,42,69],[39,72,42,70],[39,81,42,79],[39,82,42,80],[39,83,42,81],[39,95,42,93],[39,96,42,94],[40,12,43,10],[40,18,43,16,"start_timestamp"],[40,33,43,31],[40,36,43,34,"context"],[40,43,43,41],[40,47,43,45,"context"],[40,54,43,52],[40,55,43,53],[40,64,43,62],[40,65,43,63],[40,69,43,67,"context"],[40,76,43,74],[40,77,43,75],[40,86,43,84],[40,87,43,85],[40,88,43,86],[40,105,43,103],[40,106,43,104],[41,12,45,10],[41,16,45,14],[41,23,45,21,"profile_id"],[41,33,45,31],[41,38,45,36],[41,46,45,44],[41,48,45,46],[42,14,46,12,"DEBUG_BUILD"],[42,37,46,23],[42,41,46,27,"logger"],[42,53,46,33],[42,54,46,34,"log"],[42,57,46,37],[42,58,46,38],[42,128,46,108],[42,129,46,109],[43,14,47,12],[44,12,48,10],[45,12,50,10],[45,16,50,14],[45,17,50,15,"profile_id"],[45,27,50,25],[45,29,50,27],[46,14,51,12,"DEBUG_BUILD"],[46,37,51,23],[46,41,51,27,"logger"],[46,53,51,33],[46,54,51,34,"log"],[46,57,51,37],[46,58,51,38],[46,128,51,108],[46,129,51,109],[47,14,52,12],[48,12,53,10],[50,12,55,10],[51,12,56,10],[51,16,56,14,"context"],[51,23,56,21],[51,27,56,25,"context"],[51,34,56,32],[51,35,56,33],[51,44,56,42],[51,45,56,43],[51,47,56,45],[52,14,57,12],[52,21,57,19,"context"],[52,28,57,26],[52,29,57,27,"profile"],[52,36,57,34],[53,12,58,10],[54,12,60,10],[54,18,60,16,"profile"],[54,25,60,23],[54,28,60,26],[54,32,60,26,"takeProfileFromGlobalCache"],[54,65,60,52],[54,67,60,53,"profile_id"],[54,77,60,63],[54,78,60,64],[55,12,61,10],[55,16,61,14],[55,17,61,15,"profile"],[55,24,61,22],[55,26,61,24],[56,14,62,12,"DEBUG_BUILD"],[56,37,62,23],[56,41,62,27,"logger"],[56,53,62,33],[56,54,62,34,"log"],[56,57,62,37],[56,58,62,38],[56,110,62,90,"profile_id"],[56,120,62,100],[56,122,62,102],[56,123,62,103],[57,14,63,12],[58,12,64,10],[59,12,66,10],[59,18,66,16,"profileEvent"],[59,30,66,28],[59,33,66,31],[59,37,66,31,"createProfilingEvent"],[59,64,66,51],[59,66,67,12,"profile_id"],[59,76,67,22],[59,78,68,12,"start_timestamp"],[59,93,68,27],[59,95,69,12,"profile"],[59,102,69,19],[59,104,70,12,"profiledTransaction"],[59,123,71,10],[59,124,71,11],[60,12,72,10],[60,16,72,14,"profileEvent"],[60,28,72,26],[60,30,72,28],[61,14,73,12,"profilesToAddToEnvelope"],[61,37,73,35],[61,38,73,36,"push"],[61,42,73,40],[61,43,73,41,"profileEvent"],[61,55,73,53],[61,56,73,54],[62,12,74,10],[63,10,75,8],[64,10,77,8],[64,14,77,8,"addProfilesToEnvelope"],[64,42,77,29],[64,44,77,30,"envelope"],[64,52,77,38],[64,54,77,41,"profilesToAddToEnvelope"],[64,77,77,64],[64,78,77,65],[65,8,78,6],[65,9,78,7],[65,10,78,8],[66,6,79,4],[67,4,80,2],[67,5,80,3],[68,2,81,0],[68,3,81,2],[69,2,83,0],[69,8,83,6,"browserProfilingIntegration"],[69,35,83,33],[69,38,83,33,"exports"],[69,45,83,33],[69,46,83,33,"browserProfilingIntegration"],[69,73,83,33],[69,76,83,36],[69,80,83,36,"defineIntegration"],[69,103,83,53],[69,105,83,54,"_browserProfilingIntegration"],[69,133,83,82],[69,134,83,83],[70,0,83,84],[70,3]],"functionMap":{"names":["<global>","_browserProfilingIntegration","setup","client.on$argument_1"],"mappings":"AAA;sCCO;ICG;6BCU;ODI;kCCE;ODmD;KDC;CDE"}},"type":"js/module"}]}