{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":97,"index":97}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"]}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":98},"end":{"line":2,"column":48,"index":146}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"]}},{"name":"../helpers.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":147},"end":{"line":3,"column":39,"index":186}}],"key":"xGB1RU1bemGAHq3E44EIR7oSA2c=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.registerBackgroundTabDetection = registerBackgroundTabDetection;\n  var _core = require(_dependencyMap[0], \"@sentry/core\");\n  var _debugBuild = require(_dependencyMap[1], \"../debug-build.js\");\n  var _helpers = require(_dependencyMap[2], \"../helpers.js\");\n  /**\n   * Add a listener that cancels and finishes a transaction when the global\n   * document is hidden.\n   */\n  function registerBackgroundTabDetection() {\n    if (_helpers.WINDOW && _helpers.WINDOW.document) {\n      _helpers.WINDOW.document.addEventListener('visibilitychange', () => {\n        const activeSpan = (0, _core.getActiveSpan)();\n        if (!activeSpan) {\n          return;\n        }\n        const rootSpan = (0, _core.getRootSpan)(activeSpan);\n        if (_helpers.WINDOW.document.hidden && rootSpan) {\n          const cancelledStatus = 'cancelled';\n          const {\n            op,\n            status\n          } = (0, _core.spanToJSON)(rootSpan);\n          if (_debugBuild.DEBUG_BUILD) {\n            _core.logger.log(`[Tracing] Transaction: ${cancelledStatus} -> since tab moved to the background, op: ${op}`);\n          }\n\n          // We should not set status if it is already set, this prevent important statuses like\n          // error or data loss from being overwritten on transaction.\n          if (!status) {\n            rootSpan.setStatus({\n              code: _core.SPAN_STATUS_ERROR,\n              message: cancelledStatus\n            });\n          }\n          rootSpan.setAttribute('sentry.cancellation_reason', 'document.hidden');\n          rootSpan.end();\n        }\n      });\n    } else {\n      _debugBuild.DEBUG_BUILD && _core.logger.warn('[Tracing] Could not set up background tab detection due to lack of global document');\n    }\n  }\n});","lineCount":47,"map":[[6,2,1,0],[6,6,1,0,"_core"],[6,11,1,0],[6,14,1,0,"require"],[6,21,1,0],[6,22,1,0,"_dependencyMap"],[6,36,1,0],[7,2,2,0],[7,6,2,0,"_debugBuild"],[7,17,2,0],[7,20,2,0,"require"],[7,27,2,0],[7,28,2,0,"_dependencyMap"],[7,42,2,0],[8,2,3,0],[8,6,3,0,"_helpers"],[8,14,3,0],[8,17,3,0,"require"],[8,24,3,0],[8,25,3,0,"_dependencyMap"],[8,39,3,0],[9,2,5,0],[10,0,6,0],[11,0,7,0],[12,0,8,0],[13,2,9,0],[13,11,9,9,"registerBackgroundTabDetection"],[13,41,9,39,"registerBackgroundTabDetection"],[13,42,9,39],[13,44,9,42],[14,4,10,2],[14,8,10,6,"WINDOW"],[14,23,10,12],[14,27,10,16,"WINDOW"],[14,42,10,22],[14,43,10,23,"document"],[14,51,10,31],[14,53,10,33],[15,6,11,4,"WINDOW"],[15,21,11,10],[15,22,11,11,"document"],[15,30,11,19],[15,31,11,20,"addEventListener"],[15,47,11,36],[15,48,11,37],[15,66,11,55],[15,68,11,57],[15,74,11,63],[16,8,12,6],[16,14,12,12,"activeSpan"],[16,24,12,22],[16,27,12,25],[16,31,12,25,"getActiveSpan"],[16,50,12,38],[16,52,12,39],[16,53,12,40],[17,8,13,6],[17,12,13,10],[17,13,13,11,"activeSpan"],[17,23,13,21],[17,25,13,23],[18,10,14,8],[19,8,15,6],[20,8,17,6],[20,14,17,12,"rootSpan"],[20,22,17,20],[20,25,17,23],[20,29,17,23,"getRootSpan"],[20,46,17,34],[20,48,17,35,"activeSpan"],[20,58,17,45],[20,59,17,46],[21,8,19,6],[21,12,19,10,"WINDOW"],[21,27,19,16],[21,28,19,17,"document"],[21,36,19,25],[21,37,19,26,"hidden"],[21,43,19,32],[21,47,19,36,"rootSpan"],[21,55,19,44],[21,57,19,46],[22,10,20,8],[22,16,20,14,"cancelledStatus"],[22,31,20,29],[22,34,20,32],[22,45,20,43],[23,10,22,8],[23,16,22,14],[24,12,22,16,"op"],[24,14,22,18],[25,12,22,20,"status"],[26,10,22,27],[26,11,22,28],[26,14,22,31],[26,18,22,31,"spanToJSON"],[26,34,22,41],[26,36,22,42,"rootSpan"],[26,44,22,50],[26,45,22,51],[27,10,24,8],[27,14,24,12,"DEBUG_BUILD"],[27,37,24,23],[27,39,24,25],[28,12,25,10,"logger"],[28,24,25,16],[28,25,25,17,"log"],[28,28,25,20],[28,29,25,21],[28,55,25,47,"cancelledStatus"],[28,70,25,62],[28,116,25,108,"op"],[28,118,25,110],[28,120,25,112],[28,121,25,113],[29,10,26,8],[31,10,28,8],[32,10,29,8],[33,10,30,8],[33,14,30,12],[33,15,30,13,"status"],[33,21,30,19],[33,23,30,21],[34,12,31,10,"rootSpan"],[34,20,31,18],[34,21,31,19,"setStatus"],[34,30,31,28],[34,31,31,29],[35,14,31,31,"code"],[35,18,31,35],[35,20,31,37,"SPAN_STATUS_ERROR"],[35,43,31,54],[36,14,31,56,"message"],[36,21,31,63],[36,23,31,65,"cancelledStatus"],[37,12,31,81],[37,13,31,82],[37,14,31,83],[38,10,32,8],[39,10,34,8,"rootSpan"],[39,18,34,16],[39,19,34,17,"setAttribute"],[39,31,34,29],[39,32,34,30],[39,60,34,58],[39,62,34,60],[39,79,34,77],[39,80,34,78],[40,10,35,8,"rootSpan"],[40,18,35,16],[40,19,35,17,"end"],[40,22,35,20],[40,23,35,21],[40,24,35,22],[41,8,36,6],[42,6,37,4],[42,7,37,5],[42,8,37,6],[43,4,38,2],[43,5,38,3],[43,11,38,9],[44,6,39,4,"DEBUG_BUILD"],[44,29,39,15],[44,33,39,19,"logger"],[44,45,39,25],[44,46,39,26,"warn"],[44,50,39,30],[44,51,39,31],[44,135,39,115],[44,136,39,116],[45,4,40,2],[46,2,41,0],[47,0,41,1],[47,3]],"functionMap":{"names":["<global>","registerBackgroundTabDetection","WINDOW.document.addEventListener$argument_1"],"mappings":"AAA;ACQ;yDCE;KD0B;CDI"}},"type":"js/module"}]}